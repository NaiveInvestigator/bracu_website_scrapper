<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>News</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container my-5">
      <h1 class="mb-4">Latest News</h1>
      <!-- Filter Form -->
      <form id="filterForm" class="row g-3 mb-4">
        <div class="col-md-6">
          <label class="form-label">Title</label>
          <input type="text" class="form-control" id="title" placeholder="e.g. BRAC University">
        </div>
        <div class="col-md-3">
          <label class="form-label">Start Date</label>
          <input type="date" class="form-control" id="startDate">
        </div>
        <div class="col-md-3">
          <label class="form-label">End Date</label>
          <input type="date" class="form-control" id="endDate">
        </div>
        <div class="col-md-3">
          <label class="form-label">Exact Date</label>
          <input type="date" class="form-control" id="exactDate">
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary">Fetch News</button>
        </div>
      </form>
      <!-- Results -->
      <div id="results" class="row g-3"></div>
    </div>
    <script>
      async function loadNews(query = "") {
      try {
        const response = await fetch(`http://localhost:8000/news${query}`);
        const data = await response.json();

        const container = document.getElementById("results");
        container.innerHTML = "";

        if (!Array.isArray(data) || data.length === 0) {
          container.innerHTML = `
            <div class="col-12">
              <div class="alert alert-warning text-center">
                No news found for the given filters.
              </div>
            </div>
          `;
          return;
        }

        data.forEach((item, index) => {
          const card = document.createElement("div");
          card.className = "col-md-6";

          // Handle image carousel if multiple images
          let carouselHtml = "";
          if (item.image_url && item.image_url.length > 0) {
            const carouselId = `carousel${index}`;
            carouselHtml = `
              <div id="${carouselId}" class="carousel slide mb-3" data-bs-ride="carousel">
                <div class="carousel-inner">
                  ${item.image_url.map((url, i) => `
                    <div class="carousel-item ${i === 0 ? 'active' : ''}">
                      <img src="${url}" class="d-block w-100 rounded" alt="news image">
                    </div>
                  `).join("")}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
                  <span class="carousel-control-next-icon"></span>
                </button>
              </div>
            `;
          }

          card.innerHTML = `
            <div class="card shadow-sm h-100">
              ${carouselHtml}
              <div class="card-body">
                <h5 class="card-title">${item.title}</h5>
                <p class="card-text text-muted small">
                  Published: ${new Date(item.published_date).toLocaleDateString()}
                </p>
                <p class="card-text">${item.message.split("\\n")[0]}</p>
                <button class="btn btn-link p-0" onclick="alert('${item.message.replace(/'/g, "\\'")}')">
                  Read full
                </button>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error("Error fetching news:", err);
        document.getElementById("results").innerHTML = `
          <div class="col-12">
            <div class="alert alert-danger text-center">
              Failed to fetch news. Please try again later.
            </div>
          </div>
        `;
      }
    }

    // Handle form submission
    document.getElementById("filterForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const title = document.getElementById("title").value.trim();
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      const exactDate = document.getElementById("exactDate").value;

      const params = new URLSearchParams();
      if (title) params.append("title", title);
      if (startDate) params.append("start_date", startDate);
      if (endDate) params.append("end_date", endDate);
      if (exactDate) params.append("exact_date", exactDate);

      const query = params.toString() ? `?${params.toString()}` : "";
      loadNews(query);
    });

    // Load default news on page load
    loadNews();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
